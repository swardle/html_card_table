<!DOCTYPE HTML>
<html>
<script src="js/CardSprites.js"></script>


<head>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<script>
    window.addEventListener('load', function () {
        let deck = CreateDeck();
        let hand = []
        let numPlayer = 3
        for (let i = 0; i < numPlayer; i++) {
            hand.push([]);
        }

        // deal all of the cards
        while (deck.length != 0) {
            for (let i = 0; i < numPlayer; i++) {
                let card = deck.pop();
                hand[i].push(card)
                if (deck.length == 0) {
                    break;
                }
            }
        }




        for (let player_index = 0; player_index < numPlayer; player_index++) {
            let cardpos = 0;
            for (const card of hand[player_index]) {
                var div = document.getElementById(`CardContainer${player_index}`);
                let str = `<img id="${cardToSpriteFileName(card)}" class="Cards" src="img/${cardToSpriteFileName(card)}">`
                div.innerHTML += str;
                cardpos++;
            }
        }


        for (let player_index = 0; player_index < numPlayer; player_index++) {
            const container = document.querySelector(`#CardContainer${player_index}`);
            const cards = container.querySelectorAll(".Cards");
            let cardpos = 0;
            for (const card of cards) {
                card.style.cssText = `transform: translate(${cardpos * 1.5}em, ${0}em);`
                cardpos++;
            }
        }

        const items = document.querySelectorAll('.Cards');

        items.forEach(item => {
            item.addEventListener('dragstart', dragStart);
        });

        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.id);
            setTimeout(() => {
                e.target.classList.add('hide');
            }, 0);
        }

        const boxes = document.querySelectorAll('.CardContainer');

        boxes.forEach(box => {
            box.addEventListener('dragenter', dragEnter)
            box.addEventListener('dragover', dragOver);
            box.addEventListener('dragleave', dragLeave);
            box.addEventListener('drop', drop);
        });



        function dragEnter(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function dragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function dragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function drop(e) {
            e.currentTarget.classList.remove('drag-over');
            // get the draggable element
            const id = e.dataTransfer.getData('text/plain');
            const draggable = document.getElementById(id);

            // add it to the drop target
            e.currentTarget.appendChild(draggable);

            // display the draggable element
            draggable.classList.remove('hide');            
            for (let player_index = 0; player_index < numPlayer; player_index++) {
                const container = document.querySelector(`#CardContainer${player_index}`);
                const cards = container.querySelectorAll(".Cards");
                let cardpos = 0;
                for (const card of cards) {
                    card.style.cssText = `transform: translate(${cardpos * 1.5}em, ${0}em);`
                    cardpos++;
                }
            }

        }
    })
</script>


<body>

    <h2>Card</h2>

    <div id="CardContainer0" class="CardContainer">
    </div>

    <div id="CardContainer1" class="CardContainer">
    </div>

    <div id="CardContainer2" class="CardContainer">
    </div>

</body>

</html>