<!DOCTYPE HTML>
<html>
<script src="js/CardSprites.js"></script>


<head>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<script>
    window.addEventListener('load', function () {
        let deck = CreateDeck();
        let hands = []
        let numPlayer = 3
        for (let i = 0; i < numPlayer; i++) {
            hands.push([]);
        }

        // deal all of the cards
        while (deck.length != 0) {
            for (let i = 0; i < numPlayer; i++) {
                let card = deck.pop();
                hands[i].push(card)
                if (deck.length == 0) {
                    break;
                }
            }
        }


        let moving = null;


        function pickup(event) {
            moving = event.target;

            moving.style.height = moving.clientHeight;
            moving.style.width = moving.clientWidth;
            moving.style.position = 'fixed';
            moving.style.zIndex = '-10';
        }

        function move(event) {
            if (moving) {
                if (event.clientX) {
                    // mousemove
                    moving.style.left = event.clientX - moving.clientWidth/2;
                    moving.style.top = event.clientY - moving.clientHeight/2;
                } else {
                    // touchmove - assuming a single touchpoint
                    moving.style.left = event.changedTouches[0].clientX - moving.clientWidth/2;
                    moving.style.top = event.changedTouches[0].clientY - moving.clientHeight/2;
                }
            }
        }

        function drop(event) {
            if (moving) {
                if (event.currentTarget.tagName !== 'HTML') {
                    let target = null;
                    if (event.clientX) {
                        target = document.elementFromPoint(event.clientX, event.clientY);
                    } else {
                        target = document.elementFromPoint(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
                    }
                    const id = moving.id;
                    console.log(`dropped = ${id}`)
                    let container_id = target.id.replace("CardContainer","");

                    // sort the and position cards
                    hands[container_id].push(SpriteFileNameToCard(id));
                    DrawCardContainers(hands, numPlayer);
                }
                moving = null;
            }
        }

        DrawCardContainers(hands, numPlayer)

        const body = document.getElementsByTagName("BODY");          
        body.forEach(item => {
            item.addEventListener('mouseup', (e) => {
                    return drop(e, hands, numPlayer);
                });
            item.addEventListener('touchend', (e) => {
                return drop(e, hands, numPlayer);
            });
            item.addEventListener('mousemove', (e) => {
                return move(e, hands, numPlayer);
            });
            item.addEventListener('touchmove', (e) => {
                return move(e, hands, numPlayer);
            });});

        const boxes = document.querySelectorAll('.CardContainer');
        boxes.forEach(item => {
            item.addEventListener('mouseup', (e) => {
                return drop(e, hands, numPlayer);
            });
            item.addEventListener('touchend', (e) => {
                return drop(e, hands, numPlayer);
            });
        });

        const cards = document.querySelectorAll('.Cards');
        cards.forEach(item => {
            item.addEventListener('mousedown', pickup(e));
            item.addEventListener('touchstart', pickup(e));
        });


    })
</script>


<body>

    <h2>Card</h2>

    <div id="CardContainer0" class="CardContainer" style="top: 5em; left: 2em">
    </div>

    <div id="CardContainer1" class="CardContainer"  style="top: 20em; left: 2em">
    </div>

    <div id="CardContainer2" class="CardContainer"  style="top: 35em; left: 2em">
    </div>

</body>

</html>